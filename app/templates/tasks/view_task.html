{% extends "base.html" %}

{% block title %}{{ task.title }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 class="mb-0">
                        {% if task.completed %}
                            <i class="fas fa-check-circle"></i> {{ task.title }}
                        {% else %}
                            <i class="fas fa-tasks"></i> {{ task.title }}
                        {% endif %}
                    </h2>
                    <div>
                        {% if task.priority == 'high' %}
                            <span class="badge bg-danger">üî¥ –í—ã—Å–æ–∫–∏–π</span>
                        {% elif task.priority == 'medium' %}
                            <span class="badge bg-warning">üü° –°—Ä–µ–¥–Ω–∏–π</span>
                        {% else %}
                            <span class="badge bg-success">üü¢ –ù–∏–∑–∫–∏–π</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="card-body p-5">
                <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                {% if task.description %}
                    <div class="mb-4">
                        <h5><i class="fas fa-file-alt"></i> –û–ø–∏—Å–∞–Ω–∏–µ</h5>
                        <p>{{ task.description }}</p>
                    </div>
                {% endif %}

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> 
                            {% if task.completed %}
                                <span class="badge bg-success">‚úì –ó–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                            {% else %}
                                <span class="badge bg-warning">‚è≥ –ê–∫—Ç–∏–≤–Ω–∞</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>–°–æ–∑–¥–∞–Ω–∞:</strong> {{ task.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                    </div>
                </div>

                <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                <div class="d-flex gap-2 flex-wrap">
                    <form method="POST" action="{{ url_for('tasks.toggle_task', task_id=task.id) }}" style="display:inline;">
                        {% if task.completed %}
                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-redo"></i> –í–µ—Ä–Ω—É—Ç—å –≤ –∞–∫—Ç–∏–≤–Ω—ã–µ
                            </button>
                        {% else %}
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-check"></i> –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                            </button>
                        {% endif %}
                    </form>

                    <a href="{{ url_for('tasks.edit_task', task_id=task.id) }}" class="btn btn-outline-primary">
                        <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>

                    <a href="{{ url_for('tasks.share_task', task_id=task.id) }}" class="btn btn-outline-info">
                        <i class="fas fa-share"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                    </a>

                    <form method="POST" action="{{ url_for('tasks.delete_task', task_id=task.id) }}" 
                          style="display:inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?');">
                        <button type="submit" class="btn btn-outline-danger">
                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </form>

                    <a href="{{ url_for('tasks.task_list') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                    </a>
                </div>

                <!-- –°—Å—ã–ª–∫–∞ –¥–ª—è –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ -->
                {% if task.shared_task %}
                    <hr>
                    <div class="alert alert-info">
                        <h6><i class="fas fa-link"></i> –≠—Ç–∞ –∑–∞–¥–∞—á–∞ –æ–±—â–∞—è</h6>
                        <p class="mb-2">
                            –¢–æ–∫–µ–Ω: <code>{{ task.shared_task.token }}</code>
                        </p>
                        <p class="mb-0">
                            –°—Å—ã–ª–∫–∞: <code>{{ url_for('shared.view_shared_task', token=task.shared_task.token, _external=True) }}</code>
                        </p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
